write.csv(final_output, file = "~/Desktop/Neotoma.csv")
library(neotoma)
library(dplyr)
library(httr)
library(devtools)
library(rCartoAPI)
nothofagus_datasets <- get_dataset(taxonname = 'Nothofagus*',
loc = c(105, -51, 177, 10),
ageyoung = 0,
ageold = 21000)
eucalyptus_datasets <- get_dataset(taxonname = 'Eucalyptus*',
loc = c(105, -51, 177, 10),
ageyoung = 0,
ageold = 21000)
#can_datasets <- neotoma::get_dataset(datasettype = 'pollen',
#ageold = 15000, ageyoung = -100,
#gpid = "Canada")
nothofagus_dataset_numbers <- as.numeric(names(nothofagus_datasets))
eucalyptus_dataset_numbers <- as.numeric(names(eucalyptus_datasets))
site_dataset_numbers = list()
site_dataset_numbers <- append(site_dataset_numbers, c(nothofagus_dataset_numbers,
eucalyptus_dataset_numbers))
all_dataset_numbers <- as.numeric(unique(site_dataset_numbers))
data_downloads <- get_download(all_dataset_numbers)
saveRDS(data_downloads, file = "~/Desktop/Neotoma.RData")
data_downloads <- readRDS("~/Desktop/Neotoma.RData")
comp_dl <- compile_downloads(data_downloads)
data_downloads <- readRDS("~/Desktop/Neotoma.RData")
comp_dl <- compile_downloads(data_downloads)
tot_cnts <- rowSums(comp_dl[,11:ncol(comp_dl)], na.rm=TRUE)
interp_dl <- data.frame(comp_dl[,1:10],
time = - (round(comp_dl$age / 500, 0) * 500),
nothofagus = rowSums(comp_dl[, grep("Nothofagus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
eucalyptus = rowSums(comp_dl[, grep("Eucalyptus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts)  %>%
dplyr::group_by(time, lat, long, site.name) %>%
summarize(nothofagus = mean (nothofagus) * 100, eucalyptus = mean (eucalyptus) * 100)
timefltr_output <- dplyr::filter(interp_dl, time >= -21000)
final_output <- na.omit(timefltr_output)
write.csv(final_output, file = "~/Desktop/Neotoma.csv")
inputFile <- "~/Desktop/Neotoma.csv"
#This section posts the file you just created and saved locally to R
#our carto info
carto_acc = "username"
carto_api = "api key"
#optional:
#test_connection()
#Post the file!
local_import(inputFile)
