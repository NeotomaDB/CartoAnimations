legendvalues <- rep(c(10, 50, 100), length.out = nrow(final_output[,1]))
final_output$legendvalues = legendvalues
# Writes CSV file
# Specify location of file via a file path, i.e. file = "home/Code/CartoInputFile"
write.csv(final_output, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_NA_V4.csv")
inputPollen <- "~/Desktop/Github/CartoAnimations/other-files/CSVs/CartoInput_NA.csv"
inputIcesheets <- "~/Desktop/Github/CartoAnimations/other-files/old-carto-html/icesheets.geojson"
# This section posts the file you just created and saved locally to R
# This needs
#your carto info
carto_acc = "widell"
carto_api = "7de5ebf57ee0f31ed45302fb9c0b3a90723921ae"
#optional:
#test_connection()
#Post the file!
local_import(inputPollen)
local_import(inputIcesheets)
current.taxon.data <- cbind(interp_dl[,1:4],samples,rep(taxon,length(samples)))
interp_dl[,1:4]
rep(taxon,length(samples))
length(samples)
samples = as.vector(interp_dl[,i+4])
nrow(samples)
current.taxon.data <- cbind(interp_dl[,1:4],samples,rep(taxon,nrow(samples)))
View(current.taxon.data)
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
taxa
plant.data <- data.frame()
plant.data <- rbind(plant.data,current.taxon.data)
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
View(plant.data)
View(interp_dl)
common <- c('Alder', 'Beech', 'Spruce', 'Pine', 'Oak', 'Hemlock', 'Elm', 'Ragweed', 'Sedges', 'Grasses')
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
# names(samples) <- samples
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
View(plant.data)
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
names(samples) <- samples
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
View(plant.data)
names(samples) <- "samples"
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
View(current.taxon.data)
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
names(samples) <- "samples"
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
View(plant.data)
?order
plant.data[order(site.name),]
plant.data <- plant.data[order(site.name),]
plant.data <- plant.data[order(plant.data$site.name),]
View(plant.data)
plant.data <- plant.data[order(plant.data$site.name,plant.data$time),]
plant.data.no0 <- plant.data[plant.data$samples != 0,]
View(plant.data.no0)
write.csv(plant.data, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_NA_V5.csv")
write.csv(plant.data, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_NA_V5.csv")
write.csv(plant.data.no0, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_NA_V5_no0.csv")
tree_downloads <- readRDS("PollenNA.RData")
library(neotoma)
library(dplyr)
library(httr)
#If you don't have these next two packages, here's how to get them!
#They'll be useful for uploading local files to Carto, based on
#(https://dracodoc.github.io/2017/01/21/rCarto/)
#install.packages("devtools")
#devtools::install_github("dracodoc/rCartoAPI")
#If that doesn't work, try
#install.packages("remotes")
#remotes::install_github("dracodoc/rCartoAPI")
library(devtools)
tree_downloads <- readRDS("PollenNA.RData")
# Creates one spreadsheet of all downloads
comp_dl <- compile_downloads(tree_downloads)
comp_dl <- comp_dl[comp_dl$date.type != "Radiocarbon years BP",]
# Gets total counts for each observation at each site
tot_cnts <- rowSums(comp_dl[,11:ncol(comp_dl)], na.rm=TRUE)
comp_dl <- comp_dl[comp_dl$date.type != "Radiocarbon years BP",]
# Gets total counts for each observation at each site
tot_cnts <- rowSums(comp_dl[,11:ncol(comp_dl)], na.rm=TRUE)
#   summarize( Alnus = mean ( alnus) * 100,
#              Fagus = mean ( fagus) * 100,
#              Picea = mean ( picea) * 100,
#              Pinus = mean ( pinus) * 100,
#              Quercus = mean (quercus) * 100,
#              Tsuga = mean (tsuga) * 100,
#              Ulmus = mean ( ulmus) * 100,
#              Ambrosia = mean ( ambrosia) * 100,
#              Cyperaceae = mean ( cyperaceae) * 100,
#              Poaceae = mean ( poaceae) * 100)
taxa <- c('Alnus', 'Ambrosia', 'Cyperaceae', 'Fagus', 'Picea', 'Pinus', 'Poaceae', 'Quercus', 'Tsuga', 'Ulmus')
interp_dl <- data.frame(comp_dl[,1:10],
time = - (round(comp_dl$age / 500, 0) * 500),
alnus = rowSums(comp_dl[, grep("Alnus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
fagus = rowSums(comp_dl[, grep("Fagus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
picea = rowSums(comp_dl[, grep("Picea*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
pinus = rowSums(comp_dl[, grep("Pinus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
quercus = rowSums(comp_dl[, grep("Quercus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
tsuga = rowSums(comp_dl[, grep("Tsuga*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
ulmus = rowSums(comp_dl[, grep("Ulmus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
ambrosia = rowSums(comp_dl[, grep("Ambrosia*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
cyperaceae = rowSums(comp_dl[, grep("Cyperaceae*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
poaceae = rowSums(comp_dl[, grep("Poaceae*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts)%>%
group_by(time, lat, long, site.name) %>%
summarize( Alnus = mean ( alnus) * 100,
Fagus = mean ( fagus) * 100,
Picea = mean ( picea) * 100,
Pinus = mean ( pinus) * 100,
Quercus = mean (quercus) * 100,
Tsuga = mean (tsuga) * 100,
Ulmus = mean ( ulmus) * 100,
Ambrosia = mean ( ambrosia) * 100,
Cyperaceae = mean ( cyperaceae) * 100,
Poaceae = mean ( poaceae) * 100)
common <- c('Alder', 'Beech', 'Spruce', 'Pine', 'Oak', 'Hemlock', 'Elm', 'Ragweed', 'Sedges', 'Grasses')
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
names(samples) <- "samples"
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
plant.data <- plant.data[order(plant.data$site.name,plant.data$time),]
# Removes any observations from over 21,000 years ago
timefltr_output <- dplyr::filter(plant.data, time >= -21000)
final_output <- na.omit(timefltr_output)
View(final_output)
final.output.no0 <- final_output[final_output$samples != 0,]
write.csv(final_output, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_NA_V5.csv")
View(interp_dl)
View(final_output)
names(final_output[,6]) <- "taxa"
names(final_output[,6])
names(final_output[,6]) <- "taxa"
names(final_output[,6]) <- c("taxa")
names(final_output$...6) <- "taxa"
View(final_output)
names(taxa) <- "taxa"
common <- c('Alder', 'Beech', 'Spruce', 'Pine', 'Oak', 'Hemlock', 'Elm', 'Ragweed', 'Sedges', 'Grasses')
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
names(samples) <- "samples"
taxa = rep(taxon,nrow(samples))
names(taxa) <- "taxa"
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
View(plant.data)
colnames(plant.data)[colnames(plant.data) == '...6'] <- 'Taxa'
common <- c('Alder', 'Beech', 'Spruce', 'Pine', 'Oak', 'Hemlock', 'Elm', 'Ragweed', 'Sedges', 'Grasses')
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
names(samples) <- "samples"
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
colnames(plant.data)[colnames(plant.data) == '...6'] <- 'taxa'
plant.data <- plant.data[order(plant.data$site.name,plant.data$time),]
# Removes any observations from over 21,000 years ago
timefltr_output <- dplyr::filter(plant.data, time >= -21000)
final_output <- na.omit(timefltr_output)
final_output <- na.omit(timefltr_output)
final.output.no0 <- final_output[final_output$samples != 0,]
View(final.output.no0)
write.csv(final_output, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_NA_V5.csv")
write.csv(final.output.no0, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_NA_V5_no0.csv")
# Set your taxa, location, and time period of interest
taxa <- c('Alnus', 'Fagus', 'Picea', 'Quercus')
# Set your taxa, location, and time period of interest
taxa <- c('Alnus', 'Fagus', 'Picea', 'Quercus')
#c('Alnus', 'Ambrosia', 'Cyperaceae', 'Fagus', 'Picea', 'Pinus', 'Poaceae', 'Quercus', 'Tsuga', 'Ulmus') #c('Nothofagus*','Eucalyptus*')
location <- c(-11, 35, 47, 72) #c(-130, 24, -34, 65) #c(105, -51, 177, 10)
age.young <- 0
age.old <- 21000
taxa.Datasets <- list()
# Get dataset information for all taxa
for (i in 1:length(taxa)){
taxa.Datasets <- append(taxa.Datasets,(get_dataset(taxonname = paste0(taxa[i],"*"),
loc = location,
ageyoung = age.young,
ageold = age.old)))
}
#can_datasets <- neotoma::get_dataset(datasettype = 'pollen',
#ageold = 15000, ageyoung = -100,
#gpid = "Canada")
dataset.numbers <- unique(as.numeric(names(taxa.Datasets)))
pollen.download <- get_download(dataset.numbers)
# Set your taxa, location, and time period of interest
taxa <- c('Alnus', 'Fagus', 'Picea', 'Quercus')
#c('Alnus', 'Ambrosia', 'Cyperaceae', 'Fagus', 'Picea', 'Pinus', 'Poaceae', 'Quercus', 'Tsuga', 'Ulmus') #c('Nothofagus*','Eucalyptus*')
location <- c(-11, 35, 47, 72) #c(-130, 24, -34, 65) #c(105, -51, 177, 10)
age.young <- 0
age.old <- 21000
taxa.Datasets <- list()
# Get dataset information for all taxa
for (i in 1:length(taxa)){
taxa.Datasets <- append(taxa.Datasets,(get_dataset(taxonname = paste0(taxa[i],"*"),
loc = location,
ageyoung = age.young,
ageold = age.old)))
}
library(neotoma)
library(dplyr)
library(httr)
library(devtools)
library(rCartoAPI)
# Get dataset information for all taxa
for (i in 1:length(taxa)){
taxa.Datasets <- append(taxa.Datasets,(get_dataset(taxonname = paste0(taxa[i],"*"),
loc = location,
ageyoung = age.young,
ageold = age.old)))
}
dataset.numbers <- unique(as.numeric(names(taxa.Datasets)))
pollen.download <- get_download(dataset.numbers)
saveRDS(pollen.download, file = "PollenEurope-21.RData")
pollen.comp <- compile_downloads(pollen.download)
pollen.comp.clean <- pollen.comp[pollen.comp$date.type != "Radiocarbon years BP",]
View(pollen.comp.clean)
interp_dl <- data.frame(comp_dl[,1:10],
time = - (round(comp_dl$age / 500, 0) * 500),
alnus = rowSums(comp_dl[, grep("Alnus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
fagus = rowSums(comp_dl[, grep("Fagus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
picea = rowSums(comp_dl[, grep("Picea*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
quercus = rowSums(comp_dl[, grep("Quercus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Fagus = mean ( fagus) * 100,
Alnus = mean ( alnus) * 100,
Picea = mean (picea) * 100,
Quercus = mean (quercus) * 100)
tot.cnts <- rowSums(pollen.comp.clean[,11:ncol(pollen.comp.clean)], na.rm=TRUE)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
alnus = rowSums(pollen.comp.clean[, grep("Alnus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
fagus = rowSums(pollen.comp.clean[, grep("Fagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
picea = rowSums(pollen.comp.clean[, grep("Picea*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
quercus = rowSums(pollen.comp.clean[, grep("Quercus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts) %>%
dplyr::group_by(time, lat, long, site.name) %>%
summarize( Fagus   = mean(fagus)   * 100,
Alnus   = mean(alnus)   * 100,
Picea   = mean(picea)   * 100,
Quercus = mean(quercus) * 100)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
alnus = rowSums(pollen.comp.clean[, grep("Alnus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
fagus = rowSums(pollen.comp.clean[, grep("Fagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
picea = rowSums(pollen.comp.clean[, grep("Picea*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
quercus = rowSums(pollen.comp.clean[, grep("Quercus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts) %>%
dplyr::group_by(time, lat, long, site.name) %>%
summarize( Fagus   = mean(fagus)   * 100,
Alnus   = mean(alnus)   * 100,
Picea   = mean(picea)   * 100,
Quercus = mean(quercus) * 100)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
alnus = rowSums(pollen.comp.clean[, grep("Alnus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
fagus = rowSums(pollen.comp.clean[, grep("Fagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
picea = rowSums(pollen.comp.clean[, grep("Picea*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
quercus = rowSums(pollen.comp.clean[, grep("Quercus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts) %>%
dplyr::group_by(time, lat, long, site.name) %>%
summarize( Fagus   = mean(fagus)   * 100,
Alnus   = mean(alnus)   * 100,
Picea   = mean(picea)   * 100,
Quercus = mean(quercus) * 100)
View(interp_dl)
common <- c('Beech', 'Alder', 'Spruce', 'Oak')
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
names(samples) <- "samples"
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
View(plant.data)
colnames(plant.data)[colnames(plant.data) == '...6'] <- 'taxa'
plant.data <- plant.data[order(plant.data$site.name,plant.data$time),]
plant.data <- plant.data[order(plant.data$time,plant.data$site.name),]
# Removes any observations from over 21,000 years ago
timefltr_output <- dplyr::filter(plant.data, time >= -21000)
final_output <- na.omit(timefltr_output)
final.output.no0 <- final_output[final_output$samples != 0,]
write.csv(final_output, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_Euro_V2.csv")
write.csv(final.output.no0, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_Euro_V2_no0.csv")
# Set your taxa, location, and time period of interest
taxa <- c('Nothofagus*','Eucalyptus*', 'Casuarina*', 'Cupressaceae*')
#  c('Alnus', 'Ambrosia', 'Cyperaceae', 'Fagus', 'Picea', 'Pinus', 'Poaceae', 'Quercus', 'Tsuga', 'Ulmus')
#  c('Alnus', 'Fagus', 'Picea', 'Quercus')
location <- c(105, -51, 177, 10)
#c(-130, 24, -34, 65)
#c(-11, 35, 47, 72)
#c(105, -51, 177, 10)
age.young <- 0
age.old <- 21000
taxa.Datasets <- list()
# Set your taxa, location, and time period of interest
taxa <- c('Nothofagus','Eucalyptus', 'Casuarina', 'Cupressaceae')
# Get dataset information for all taxa
for (i in 1:length(taxa)){
taxa.Datasets <- append(taxa.Datasets,(get_dataset(taxonname = paste0(taxa[i],"*"),
loc = location,
ageyoung = age.young,
ageold = age.old)))
}
dataset.numbers <- unique(as.numeric(names(taxa.Datasets)))
pollen.download <- get_download(dataset.numbers)
saveRDS(pollen.download, file = "PollenAus-21.RData")
pollen.comp <- compile_downloads(pollen.download)
pollen.comp.clean <- pollen.comp[pollen.comp$date.type != "Radiocarbon years BP",]
tot.cnts <- rowSums(pollen.comp.clean[,11:ncol(pollen.comp.clean)], na.rm=TRUE)
get_dataset(taxonname = "Callitris*",                                 loc = location,
ageyoung = age.young,
ageold = age.old))
get_dataset(taxonname = "Callitris*",                                 loc = location,
ageyoung = age.young,
ageold = age.old)
# Set your taxa, location, and time period of interest
taxa <- c('Nothofagus','Eucalyptus', 'Casuarina', 'Cupressaceae', 'Callitris')
taxa.Datasets <- list()
# Get dataset information for all taxa
for (i in 1:length(taxa)){
taxa.Datasets <- append(taxa.Datasets,(get_dataset(taxonname = paste0(taxa[i],"*"),
loc = location,
ageyoung = age.young,
ageold = age.old)))
}
dataset.numbers <- unique(as.numeric(names(taxa.Datasets)))
interp_dl <- data.frame(comp_dl[,1:10],
time = - (round(comp_dl$age / 500, 0) * 500),
nothofagus = rowSums(comp_dl[, grep("Nothofagus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
eucalyptus = rowSums(comp_dl[, grep("Eucalyptus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
casuarina = rowSums(comp_dl[, grep("Casuarina*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
callitris = rowSums(comp_dl[, grep("Callitris*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts,
phyllocladus = rowSums(comp_dl[, grep("Phyllocladus*", colnames(comp_dl))], na.rm = TRUE) / tot_cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Nothofagus = mean ( nothofagus) * 100,
Phyllocladus = mean ( phyllocladus) * 100,
Casuarina = mean (casuarina) * 100,
# callitris = mean (callitris) * 100,
Eucalyptus = mean (eucalyptus) * 100)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
nothofagus = rowSums(pollen.comp.clean[, grep("Nothofagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
eucalyptus = rowSums(pollen.comp.clean[, grep("Eucalyptus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
casuarina = rowSums(pollen.comp.clean[, grep("Casuarina*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
callitris = rowSums(pollen.comp.clean[, grep("Callitris*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts,
phyllocladus = rowSums(pollen.comp.clean[, grep("Phyllocladus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot_cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Nothofagus = mean ( nothofagus) * 100,
Phyllocladus = mean ( phyllocladus) * 100,
Casuarina = mean (casuarina) * 100,
# callitris = mean (callitris) * 100,
Eucalyptus = mean (eucalyptus) * 100)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
nothofagus = rowSums(pollen.comp.clean[, grep("Nothofagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
eucalyptus = rowSums(pollen.comp.clean[, grep("Eucalyptus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
casuarina = rowSums(pollen.comp.clean[, grep("Casuarina*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
callitris = rowSums(pollen.comp.clean[, grep("Callitris*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
phyllocladus = rowSums(pollen.comp.clean[, grep("Phyllocladus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Nothofagus = mean ( nothofagus) * 100,
Phyllocladus = mean ( phyllocladus) * 100,
Casuarina = mean (casuarina) * 100,
# callitris = mean (callitris) * 100,
Eucalyptus = mean (eucalyptus) * 100)
tot.cnts <- rowSums(pollen.comp.clean[,11:ncol(pollen.comp.clean)], na.rm=TRUE)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
nothofagus = rowSums(pollen.comp.clean[, grep("Nothofagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
eucalyptus = rowSums(pollen.comp.clean[, grep("Eucalyptus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
casuarina = rowSums(pollen.comp.clean[, grep("Casuarina*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
callitris = rowSums(pollen.comp.clean[, grep("Callitris*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
phyllocladus = rowSums(pollen.comp.clean[, grep("Phyllocladus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Nothofagus = mean ( nothofagus) * 100,
Phyllocladus = mean ( phyllocladus) * 100,
Casuarina = mean (casuarina) * 100,
# callitris = mean (callitris) * 100,
Eucalyptus = mean (eucalyptus) * 100)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
nothofagus = rowSums(pollen.comp.clean[, grep("Nothofagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
eucalyptus = rowSums(pollen.comp.clean[, grep("Eucalyptus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
casuarina = rowSums(pollen.comp.clean[, grep("Casuarina*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
callitris = rowSums(pollen.comp.clean[, grep("Callitris*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
phyllocladus = rowSums(pollen.comp.clean[, grep("Phyllocladus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Nothofagus = mean ( nothofagus) * 100,
Phyllocladus = mean ( phyllocladus) * 100,
Casuarina = mean (casuarina) * 100,
Callitris = mean (callitris) * 100,
Eucalyptus = mean (eucalyptus) * 100)
pollen.comp.clean[,"Callitris*"]
pollen.comp.clean[,"Callitris"]
rowSums(pollen.comp.clean[,"Callitris"], na.rm = TRUE)
callitris = pollen.comp.clean[,"Callitris"] / tot.cnts
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
nothofagus = rowSums(pollen.comp.clean[, grep("Nothofagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
eucalyptus = rowSums(pollen.comp.clean[, grep("Eucalyptus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
casuarina = rowSums(pollen.comp.clean[, grep("Casuarina*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
callitris = pollen.comp.clean[,"Callitris"] / tot.cnts,
phyllocladus = rowSums(pollen.comp.clean[, grep("Phyllocladus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Nothofagus = mean ( nothofagus) * 100,
Phyllocladus = mean ( phyllocladus) * 100,
Casuarina = mean (casuarina) * 100,
Callitris = mean (callitris) * 100,
Eucalyptus = mean (eucalyptus) * 100)
common <- c('She-Oak', 'Eucalyptus', 'Beech', 'Celery Pine')
get_dataset(taxonname = "Phyllocladus*",
loc = location,
ageyoung = age.young,
ageold = age.old)
colnames(comp_dl[1, grep("Phyllocladus*", colnames(pollen.comp.clean))])
colnames(pollen.comp.clean[1, grep("Phyllocladus*", colnames(pollen.comp.clean))])
colnames(pollen.comp.clean[1, grep("Cupressaceae*", colnames(pollen.comp.clean))])
get_dataset(taxonname = "Cupressaceae*",
loc = location,
ageyoung = age.young,
ageold = age.old)
# Set your taxa, location, and time period of interest
taxa <- c('Nothofagus','Eucalyptus', 'Casuarina', 'Phyllocladus', 'Callitris')
#  c('Alnus', 'Ambrosia', 'Cyperaceae', 'Fagus', 'Picea', 'Pinus', 'Poaceae', 'Quercus', 'Tsuga', 'Ulmus')
#  c('Alnus', 'Fagus', 'Picea', 'Quercus')
location <- c(105, -51, 177, 10)
#c(-130, 24, -34, 65)
#c(-11, 35, 47, 72)
#c(105, -51, 177, 10)
age.young <- 0
age.old <- 21000
taxa.Datasets <- list()
# Get dataset information for all taxa
for (i in 1:length(taxa)){
taxa.Datasets <- append(taxa.Datasets,(get_dataset(taxonname = paste0(taxa[i],"*"),
loc = location,
ageyoung = age.young,
ageold = age.old)))
}
dataset.numbers <- unique(as.numeric(names(taxa.Datasets)))
pollen.download <- get_download(dataset.numbers)
saveRDS(pollen.download, file = "PollenAus-21.RData")
pollen.comp <- compile_downloads(pollen.download)
pollen.comp.clean <- pollen.comp[pollen.comp$date.type != "Radiocarbon years BP",]
tot.cnts <- rowSums(pollen.comp.clean[,11:ncol(pollen.comp.clean)], na.rm=TRUE)
interp_dl <- data.frame(pollen.comp.clean[,1:10],
time = - (round(pollen.comp.clean$age / 500, 0) * 500),
nothofagus = rowSums(pollen.comp.clean[, grep("Nothofagus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
eucalyptus = rowSums(pollen.comp.clean[, grep("Eucalyptus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
casuarina = rowSums(pollen.comp.clean[, grep("Casuarina*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts,
callitris = pollen.comp.clean[,"Callitris"] / tot.cnts,
phyllocladus = rowSums(pollen.comp.clean[, grep("Phyllocladus*", colnames(pollen.comp.clean))], na.rm = TRUE) / tot.cnts) %>%
group_by(time, lat, long, site.name) %>%
summarize( Nothofagus = mean ( nothofagus) * 100,
Phyllocladus = mean ( phyllocladus) * 100,
Casuarina = mean (casuarina) * 100,
Callitris = mean (callitris) * 100,
Eucalyptus = mean (eucalyptus) * 100)
common <- c('Beech', 'Celery Pine', 'She-Oak', 'Cypress-Pine', 'Eucalyptus')
plant.data <- data.frame()
for (i in 1:length(common)) {
taxon = common[i]
samples = interp_dl[,i+4]
names(samples) <- "samples"
taxa = rep(taxon,nrow(samples))
current.taxon.data <- cbind(interp_dl[,1:4],samples,taxa)
plant.data <- rbind(plant.data,current.taxon.data)
}
colnames(plant.data)[colnames(plant.data) == '...6'] <- 'taxa'
plant.data <- plant.data[order(plant.data$time,plant.data$site.name),]
# Removes any observations from over 21,000 years ago
timefltr_output <- dplyr::filter(plant.data, time >= -21000)
final_output <- na.omit(timefltr_output)
final.output.no0 <- final_output[final_output$samples != 0,]
write.csv(final_output, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_Aus_V2.csv")
write.csv(final.output.no0, file = "~/Github/CartoAnimations/other-files/CSVs/CartoInput_Aus_V2_no0.csv")
